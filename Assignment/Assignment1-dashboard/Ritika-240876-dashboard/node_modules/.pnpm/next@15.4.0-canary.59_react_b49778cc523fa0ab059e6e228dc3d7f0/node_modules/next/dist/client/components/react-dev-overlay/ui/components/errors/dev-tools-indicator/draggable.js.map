{"version":3,"sources":["../../../../../../../../src/client/components/react-dev-overlay/ui/components/errors/dev-tools-indicator/draggable.tsx"],"sourcesContent":["import { useRef } from 'react'\n\ninterface Point {\n  x: number\n  y: number\n}\n\ntype Corners = 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right'\n\ninterface Corner {\n  corner: Corners\n  translation: Point\n}\n\nexport function Draggable({\n  children,\n  padding,\n  position: currentCorner,\n  setPosition: setCurrentCorner,\n  onDragStart,\n}: {\n  children: React.ReactElement\n  position: Corners\n  padding: number\n  setPosition: (position: Corners) => void\n  onDragStart?: () => void\n}) {\n  const { ref, animate, ...drag } = useDrag({\n    threshold: 5,\n    onDragStart,\n    onDragEnd,\n    onAnimationEnd,\n  })\n\n  function onDragEnd(translation: Point, velocity: Point) {\n    const projectedPosition = {\n      x: translation.x + project(velocity.x),\n      y: translation.y + project(velocity.y),\n    }\n    const nearestCorner = getNearestCorner(projectedPosition)\n    animate(nearestCorner)\n  }\n\n  function onAnimationEnd({ corner }: Corner) {\n    // Unset drag translation\n    setTimeout(() => {\n      ref.current?.style.removeProperty('translate')\n      setCurrentCorner(corner)\n    })\n  }\n\n  function getNearestCorner({ x, y }: Point): Corner {\n    const allCorners = getCorners()\n    const distances = Object.entries(allCorners).map(([key, translation]) => {\n      const distance = Math.sqrt(\n        (x - translation.x) ** 2 + (y - translation.y) ** 2\n      )\n      return { key, distance }\n    })\n    const min = Math.min(...distances.map((d) => d.distance))\n    const nearest = distances.find((d) => d.distance === min)\n    if (!nearest) {\n      // Safety fallback\n      return { corner: currentCorner, translation: allCorners[currentCorner] }\n    }\n    return {\n      translation: allCorners[nearest.key as Corners],\n      corner: nearest.key as Corners,\n    }\n  }\n\n  function getCorners(): Record<Corners, Point> {\n    const offset = padding * 2\n    const triggerWidth = ref.current?.offsetWidth || 0\n    const triggerHeight = ref.current?.offsetHeight || 0\n    const scrollbarWidth =\n      window.innerWidth - document.documentElement.clientWidth\n\n    function getAbsolutePosition(corner: Corners) {\n      const isRight = corner.includes('right')\n      const isBottom = corner.includes('bottom')\n\n      return {\n        x: isRight\n          ? window.innerWidth - scrollbarWidth - offset - triggerWidth\n          : 0,\n        y: isBottom ? window.innerHeight - offset - triggerHeight : 0,\n      }\n    }\n\n    const basePosition = getAbsolutePosition(currentCorner)\n\n    // Calculate all corner positions relative to the current corner\n    return {\n      'top-left': {\n        x: 0 - basePosition.x,\n        y: 0 - basePosition.y,\n      },\n      'top-right': {\n        x:\n          window.innerWidth -\n          scrollbarWidth -\n          offset -\n          triggerWidth -\n          basePosition.x,\n        y: 0 - basePosition.y,\n      },\n      'bottom-left': {\n        x: 0 - basePosition.x,\n        y: window.innerHeight - offset - triggerHeight - basePosition.y,\n      },\n      'bottom-right': {\n        x:\n          window.innerWidth -\n          scrollbarWidth -\n          offset -\n          triggerWidth -\n          basePosition.x,\n        y: window.innerHeight - offset - triggerHeight - basePosition.y,\n      },\n    }\n  }\n\n  return (\n    <div ref={ref} {...drag} style={{ touchAction: 'none' }}>\n      {children}\n    </div>\n  )\n}\n\ninterface UseDragOptions {\n  onDragStart?: () => void\n  onDrag?: (translation: Point) => void\n  onDragEnd?: (translation: Point, velocity: Point) => void\n  onAnimationEnd?: (corner: Corner) => void\n  threshold: number // Minimum movement before drag starts\n}\n\ninterface Velocity {\n  position: Point\n  timestamp: number\n}\n\nexport function useDrag(options: UseDragOptions) {\n  const ref = useRef<HTMLDivElement>(null)\n  const state = useRef<'idle' | 'press' | 'drag' | 'drag-end'>('idle')\n\n  const origin = useRef<Point>({ x: 0, y: 0 })\n  const translation = useRef<Point>({ x: 0, y: 0 })\n  const lastTimestamp = useRef(0)\n  const velocities = useRef<Velocity[]>([])\n\n  function set(position: Point) {\n    if (ref.current) {\n      translation.current = position\n      ref.current.style.translate = `${position.x}px ${position.y}px`\n    }\n  }\n\n  function animate(corner: Corner) {\n    const el = ref.current\n    if (el === null) return\n\n    function listener(e: TransitionEvent) {\n      if (e.propertyName === 'translate') {\n        options.onAnimationEnd?.(corner)\n        translation.current = { x: 0, y: 0 }\n        el!.style.transition = ''\n        el!.removeEventListener('transitionend', listener)\n      }\n    }\n\n    // Generated from https://www.easing.dev/spring\n    el.style.transition = 'translate 491.22ms var(--timing-bounce)'\n    el.addEventListener('transitionend', listener)\n    set(corner.translation)\n  }\n\n  function onClick(e: MouseEvent) {\n    if (state.current === 'drag-end') {\n      e.preventDefault()\n      e.stopPropagation()\n      state.current = 'idle'\n      ref.current?.removeEventListener('click', onClick)\n    }\n  }\n\n  function onPointerDown(e: React.PointerEvent) {\n    if (e.button !== 0) {\n      return // ignore right click\n    }\n    origin.current = { x: e.clientX, y: e.clientY }\n    state.current = 'press'\n    window.addEventListener('pointermove', onPointerMove)\n    window.addEventListener('pointerup', onPointerUp)\n    ref.current?.addEventListener('click', onClick)\n  }\n\n  function onPointerMove(e: PointerEvent) {\n    if (state.current === 'press') {\n      const dx = e.clientX - origin.current.x\n      const dy = e.clientY - origin.current.y\n      const distance = Math.sqrt(dx * dx + dy * dy)\n\n      if (distance >= options.threshold) {\n        state.current = 'drag'\n        ref.current?.setPointerCapture(e.pointerId)\n        ref.current?.classList.add('dev-tools-grabbing')\n        options.onDragStart?.()\n      }\n    }\n\n    if (state.current !== 'drag') return\n\n    const currentPosition = { x: e.clientX, y: e.clientY }\n\n    const dx = currentPosition.x - origin.current.x\n    const dy = currentPosition.y - origin.current.y\n    origin.current = currentPosition\n\n    const newTranslation = {\n      x: translation.current.x + dx,\n      y: translation.current.y + dy,\n    }\n\n    set(newTranslation)\n\n    // Keep a history of recent positions for velocity calculation\n    // Only store points that are at least 10ms apart to avoid too many samples\n    const now = Date.now()\n    const shouldAddToHistory = now - lastTimestamp.current >= 10\n    if (shouldAddToHistory) {\n      velocities.current = [\n        ...velocities.current.slice(-5),\n        { position: currentPosition, timestamp: now },\n      ]\n    }\n\n    lastTimestamp.current = now\n    options.onDrag?.(translation.current)\n  }\n\n  function onPointerUp(e: PointerEvent) {\n    state.current = state.current === 'drag' ? 'drag-end' : 'idle'\n\n    window.removeEventListener('pointermove', onPointerMove)\n    window.removeEventListener('pointerup', onPointerUp)\n\n    const velocity = calculateVelocity(velocities.current)\n    velocities.current = []\n\n    ref.current?.classList.remove('dev-tools-grabbing')\n    ref.current?.releasePointerCapture(e.pointerId)\n    options.onDragEnd?.(translation.current, velocity)\n  }\n\n  return {\n    ref,\n    onPointerDown,\n    animate,\n  }\n}\n\nfunction calculateVelocity(\n  history: Array<{ position: Point; timestamp: number }>\n): Point {\n  if (history.length < 2) {\n    return { x: 0, y: 0 }\n  }\n\n  const oldestPoint = history[0]\n  const latestPoint = history[history.length - 1]\n\n  const timeDelta = latestPoint.timestamp - oldestPoint.timestamp\n\n  if (timeDelta === 0) {\n    return { x: 0, y: 0 }\n  }\n\n  // Calculate pixels per millisecond\n  const velocityX =\n    (latestPoint.position.x - oldestPoint.position.x) / timeDelta\n  const velocityY =\n    (latestPoint.position.y - oldestPoint.position.y) / timeDelta\n\n  // Convert to pixels per second for more intuitive values\n  return {\n    x: velocityX * 1000,\n    y: velocityY * 1000,\n  }\n}\n\nfunction project(initialVelocity: number, decelerationRate = 0.999) {\n  return ((initialVelocity / 1000) * decelerationRate) / (1 - decelerationRate)\n}\n"],"names":["Draggable","useDrag","children","padding","position","currentCorner","setPosition","setCurrentCorner","onDragStart","ref","animate","drag","threshold","onDragEnd","onAnimationEnd","translation","velocity","projectedPosition","x","project","y","nearestCorner","getNearestCorner","corner","setTimeout","current","style","removeProperty","allCorners","getCorners","distances","Object","entries","map","key","distance","Math","sqrt","min","d","nearest","find","offset","triggerWidth","offsetWidth","triggerHeight","offsetHeight","scrollbarWidth","window","innerWidth","document","documentElement","clientWidth","getAbsolutePosition","isRight","includes","isBottom","innerHeight","basePosition","div","touchAction","options","useRef","state","origin","lastTimestamp","velocities","set","translate","el","listener","e","propertyName","transition","removeEventListener","addEventListener","onClick","preventDefault","stopPropagation","onPointerDown","button","clientX","clientY","onPointerMove","onPointerUp","dx","dy","setPointerCapture","pointerId","classList","add","currentPosition","newTranslation","now","Date","shouldAddToHistory","slice","timestamp","onDrag","calculateVelocity","remove","releasePointerCapture","history","length","oldestPoint","latestPoint","timeDelta","velocityX","velocityY","initialVelocity","decelerationRate"],"mappings":"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","ignoreList":[0]}