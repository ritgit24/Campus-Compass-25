{"version":3,"sources":["../../../../../../../../src/client/components/react-dev-overlay/ui/components/errors/dev-tools-indicator/draggable.tsx"],"sourcesContent":["import { useRef } from 'react'\n\ninterface Point {\n  x: number\n  y: number\n}\n\ntype Corners = 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right'\n\ninterface Corner {\n  corner: Corners\n  translation: Point\n}\n\nexport function Draggable({\n  children,\n  padding,\n  position: currentCorner,\n  setPosition: setCurrentCorner,\n  onDragStart,\n}: {\n  children: React.ReactElement\n  position: Corners\n  padding: number\n  setPosition: (position: Corners) => void\n  onDragStart?: () => void\n}) {\n  const { ref, animate, ...drag } = useDrag({\n    threshold: 5,\n    onDragStart,\n    onDragEnd,\n    onAnimationEnd,\n  })\n\n  function onDragEnd(translation: Point, velocity: Point) {\n    const projectedPosition = {\n      x: translation.x + project(velocity.x),\n      y: translation.y + project(velocity.y),\n    }\n    const nearestCorner = getNearestCorner(projectedPosition)\n    animate(nearestCorner)\n  }\n\n  function onAnimationEnd({ corner }: Corner) {\n    // Unset drag translation\n    setTimeout(() => {\n      ref.current?.style.removeProperty('translate')\n      setCurrentCorner(corner)\n    })\n  }\n\n  function getNearestCorner({ x, y }: Point): Corner {\n    const allCorners = getCorners()\n    const distances = Object.entries(allCorners).map(([key, translation]) => {\n      const distance = Math.sqrt(\n        (x - translation.x) ** 2 + (y - translation.y) ** 2\n      )\n      return { key, distance }\n    })\n    const min = Math.min(...distances.map((d) => d.distance))\n    const nearest = distances.find((d) => d.distance === min)\n    if (!nearest) {\n      // Safety fallback\n      return { corner: currentCorner, translation: allCorners[currentCorner] }\n    }\n    return {\n      translation: allCorners[nearest.key as Corners],\n      corner: nearest.key as Corners,\n    }\n  }\n\n  function getCorners(): Record<Corners, Point> {\n    const offset = padding * 2\n    const triggerWidth = ref.current?.offsetWidth || 0\n    const triggerHeight = ref.current?.offsetHeight || 0\n    const scrollbarWidth =\n      window.innerWidth - document.documentElement.clientWidth\n\n    function getAbsolutePosition(corner: Corners) {\n      const isRight = corner.includes('right')\n      const isBottom = corner.includes('bottom')\n\n      return {\n        x: isRight\n          ? window.innerWidth - scrollbarWidth - offset - triggerWidth\n          : 0,\n        y: isBottom ? window.innerHeight - offset - triggerHeight : 0,\n      }\n    }\n\n    const basePosition = getAbsolutePosition(currentCorner)\n\n    // Calculate all corner positions relative to the current corner\n    return {\n      'top-left': {\n        x: 0 - basePosition.x,\n        y: 0 - basePosition.y,\n      },\n      'top-right': {\n        x:\n          window.innerWidth -\n          scrollbarWidth -\n          offset -\n          triggerWidth -\n          basePosition.x,\n        y: 0 - basePosition.y,\n      },\n      'bottom-left': {\n        x: 0 - basePosition.x,\n        y: window.innerHeight - offset - triggerHeight - basePosition.y,\n      },\n      'bottom-right': {\n        x:\n          window.innerWidth -\n          scrollbarWidth -\n          offset -\n          triggerWidth -\n          basePosition.x,\n        y: window.innerHeight - offset - triggerHeight - basePosition.y,\n      },\n    }\n  }\n\n  return (\n    <div ref={ref} {...drag} style={{ touchAction: 'none' }}>\n      {children}\n    </div>\n  )\n}\n\ninterface UseDragOptions {\n  onDragStart?: () => void\n  onDrag?: (translation: Point) => void\n  onDragEnd?: (translation: Point, velocity: Point) => void\n  onAnimationEnd?: (corner: Corner) => void\n  threshold: number // Minimum movement before drag starts\n}\n\ninterface Velocity {\n  position: Point\n  timestamp: number\n}\n\nexport function useDrag(options: UseDragOptions) {\n  const ref = useRef<HTMLDivElement>(null)\n  const state = useRef<'idle' | 'press' | 'drag' | 'drag-end'>('idle')\n\n  const origin = useRef<Point>({ x: 0, y: 0 })\n  const translation = useRef<Point>({ x: 0, y: 0 })\n  const lastTimestamp = useRef(0)\n  const velocities = useRef<Velocity[]>([])\n\n  function set(position: Point) {\n    if (ref.current) {\n      translation.current = position\n      ref.current.style.translate = `${position.x}px ${position.y}px`\n    }\n  }\n\n  function animate(corner: Corner) {\n    const el = ref.current\n    if (el === null) return\n\n    function listener(e: TransitionEvent) {\n      if (e.propertyName === 'translate') {\n        options.onAnimationEnd?.(corner)\n        translation.current = { x: 0, y: 0 }\n        el!.style.transition = ''\n        el!.removeEventListener('transitionend', listener)\n      }\n    }\n\n    // Generated from https://www.easing.dev/spring\n    el.style.transition = 'translate 491.22ms var(--timing-bounce)'\n    el.addEventListener('transitionend', listener)\n    set(corner.translation)\n  }\n\n  function onClick(e: MouseEvent) {\n    if (state.current === 'drag-end') {\n      e.preventDefault()\n      e.stopPropagation()\n      state.current = 'idle'\n      ref.current?.removeEventListener('click', onClick)\n    }\n  }\n\n  function onPointerDown(e: React.PointerEvent) {\n    if (e.button !== 0) {\n      return // ignore right click\n    }\n    origin.current = { x: e.clientX, y: e.clientY }\n    state.current = 'press'\n    window.addEventListener('pointermove', onPointerMove)\n    window.addEventListener('pointerup', onPointerUp)\n    ref.current?.addEventListener('click', onClick)\n  }\n\n  function onPointerMove(e: PointerEvent) {\n    if (state.current === 'press') {\n      const dx = e.clientX - origin.current.x\n      const dy = e.clientY - origin.current.y\n      const distance = Math.sqrt(dx * dx + dy * dy)\n\n      if (distance >= options.threshold) {\n        state.current = 'drag'\n        ref.current?.setPointerCapture(e.pointerId)\n        ref.current?.classList.add('dev-tools-grabbing')\n        options.onDragStart?.()\n      }\n    }\n\n    if (state.current !== 'drag') return\n\n    const currentPosition = { x: e.clientX, y: e.clientY }\n\n    const dx = currentPosition.x - origin.current.x\n    const dy = currentPosition.y - origin.current.y\n    origin.current = currentPosition\n\n    const newTranslation = {\n      x: translation.current.x + dx,\n      y: translation.current.y + dy,\n    }\n\n    set(newTranslation)\n\n    // Keep a history of recent positions for velocity calculation\n    // Only store points that are at least 10ms apart to avoid too many samples\n    const now = Date.now()\n    const shouldAddToHistory = now - lastTimestamp.current >= 10\n    if (shouldAddToHistory) {\n      velocities.current = [\n        ...velocities.current.slice(-5),\n        { position: currentPosition, timestamp: now },\n      ]\n    }\n\n    lastTimestamp.current = now\n    options.onDrag?.(translation.current)\n  }\n\n  function onPointerUp(e: PointerEvent) {\n    state.current = state.current === 'drag' ? 'drag-end' : 'idle'\n\n    window.removeEventListener('pointermove', onPointerMove)\n    window.removeEventListener('pointerup', onPointerUp)\n\n    const velocity = calculateVelocity(velocities.current)\n    velocities.current = []\n\n    ref.current?.classList.remove('dev-tools-grabbing')\n    ref.current?.releasePointerCapture(e.pointerId)\n    options.onDragEnd?.(translation.current, velocity)\n  }\n\n  return {\n    ref,\n    onPointerDown,\n    animate,\n  }\n}\n\nfunction calculateVelocity(\n  history: Array<{ position: Point; timestamp: number }>\n): Point {\n  if (history.length < 2) {\n    return { x: 0, y: 0 }\n  }\n\n  const oldestPoint = history[0]\n  const latestPoint = history[history.length - 1]\n\n  const timeDelta = latestPoint.timestamp - oldestPoint.timestamp\n\n  if (timeDelta === 0) {\n    return { x: 0, y: 0 }\n  }\n\n  // Calculate pixels per millisecond\n  const velocityX =\n    (latestPoint.position.x - oldestPoint.position.x) / timeDelta\n  const velocityY =\n    (latestPoint.position.y - oldestPoint.position.y) / timeDelta\n\n  // Convert to pixels per second for more intuitive values\n  return {\n    x: velocityX * 1000,\n    y: velocityY * 1000,\n  }\n}\n\nfunction project(initialVelocity: number, decelerationRate = 0.999) {\n  return ((initialVelocity / 1000) * decelerationRate) / (1 - decelerationRate)\n}\n"],"names":["useRef","Draggable","children","padding","position","currentCorner","setPosition","setCurrentCorner","onDragStart","ref","animate","drag","useDrag","threshold","onDragEnd","onAnimationEnd","translation","velocity","projectedPosition","x","project","y","nearestCorner","getNearestCorner","corner","setTimeout","current","style","removeProperty","allCorners","getCorners","distances","Object","entries","map","key","distance","Math","sqrt","min","d","nearest","find","offset","triggerWidth","offsetWidth","triggerHeight","offsetHeight","scrollbarWidth","window","innerWidth","document","documentElement","clientWidth","getAbsolutePosition","isRight","includes","isBottom","innerHeight","basePosition","div","touchAction","options","state","origin","lastTimestamp","velocities","set","translate","el","listener","e","propertyName","transition","removeEventListener","addEventListener","onClick","preventDefault","stopPropagation","onPointerDown","button","clientX","clientY","onPointerMove","onPointerUp","dx","dy","setPointerCapture","pointerId","classList","add","currentPosition","newTranslation","now","Date","shouldAddToHistory","slice","timestamp","onDrag","calculateVelocity","remove","releasePointerCapture","history","length","oldestPoint","latestPoint","timeDelta","velocityX","velocityY","initialVelocity","decelerationRate"],"mappings":"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","ignoreList":[0]}