{"version":3,"sources":["../../../../../../../../src/client/components/react-dev-overlay/ui/components/errors/error-overlay-layout/error-overlay-layout.tsx"],"sourcesContent":["import * as React from 'react'\nimport type { DebugInfo } from '../../../../types'\nimport type { ErrorMessageType } from '../error-message/error-message'\nimport type { ErrorType } from '../error-type-label/error-type-label'\n\nimport { DialogContent } from '../../dialog'\nimport {\n  ErrorOverlayToolbar,\n  styles as toolbarStyles,\n} from '../error-overlay-toolbar/error-overlay-toolbar'\nimport { ErrorOverlayFooter } from '../error-overlay-footer/error-overlay-footer'\nimport {\n  ErrorMessage,\n  styles as errorMessageStyles,\n} from '../error-message/error-message'\nimport {\n  ErrorTypeLabel,\n  styles as errorTypeLabelStyles,\n} from '../error-type-label/error-type-label'\nimport {\n  ErrorOverlayNav,\n  styles as floatingHeaderStyles,\n} from '../error-overlay-nav/error-overlay-nav'\n\nimport { ErrorOverlayDialog, DIALOG_STYLES } from '../dialog/dialog'\nimport {\n  ErrorOverlayDialogHeader,\n  DIALOG_HEADER_STYLES,\n} from '../dialog/header'\nimport { ErrorOverlayDialogBody, DIALOG_BODY_STYLES } from '../dialog/body'\nimport { CALL_STACK_STYLES } from '../call-stack/call-stack'\nimport { OVERLAY_STYLES, ErrorOverlayOverlay } from '../overlay/overlay'\nimport { ErrorOverlayBottomStack } from '../error-overlay-bottom-stack'\nimport type { ErrorBaseProps } from '../error-overlay/error-overlay'\nimport type { ReadyRuntimeError } from '../../../../utils/get-error-by-type'\nimport { EnvironmentNameLabel } from '../environment-name-label/environment-name-label'\nimport { useFocusTrap } from '../dev-tools-indicator/utils'\nimport { Fader } from '../../fader'\nimport { Resizer } from '../../resizer'\n\nexport interface ErrorOverlayLayoutProps extends ErrorBaseProps {\n  errorMessage: ErrorMessageType\n  errorType: ErrorType\n  children?: React.ReactNode\n  errorCode?: string\n  error: ReadyRuntimeError['error']\n  debugInfo?: DebugInfo\n  isBuildError?: boolean\n  onClose?: () => void\n  // TODO: better handle receiving\n  runtimeErrors?: ReadyRuntimeError[]\n  activeIdx?: number\n  setActiveIndex?: (index: number) => void\n  footerMessage?: string\n  dialogResizerRef?: React.RefObject<HTMLDivElement | null>\n}\n\nexport function ErrorOverlayLayout({\n  errorMessage,\n  errorType,\n  children,\n  errorCode,\n  errorCount,\n  error,\n  debugInfo,\n  isBuildError,\n  onClose,\n  versionInfo,\n  runtimeErrors,\n  activeIdx,\n  setActiveIndex,\n  footerMessage,\n  isTurbopack,\n  dialogResizerRef,\n  // This prop is used to animate the dialog, it comes from a parent component (<ErrorOverlay>)\n  // If it's not being passed, we should just render the component as it is being\n  // used without the context of a parent component that controls its state (e.g. Storybook).\n  rendered = true,\n  transitionDurationMs,\n}: ErrorOverlayLayoutProps) {\n  const animationProps = {\n    'data-rendered': rendered,\n    style: {\n      '--transition-duration': `${transitionDurationMs}ms`,\n    } as React.CSSProperties,\n  }\n\n  const [animating, setAnimating] = React.useState(\n    Boolean(transitionDurationMs)\n  )\n\n  const faderRef = React.useRef<HTMLDivElement | null>(null)\n  const hasFooter = Boolean(footerMessage || errorCode)\n  const dialogRef = React.useRef<HTMLDivElement | null>(null)\n  useFocusTrap(dialogRef, null, rendered)\n\n  function onScroll(e: React.UIEvent<HTMLDivElement>) {\n    if (faderRef.current) {\n      const opacity = clamp(e.currentTarget.scrollTop / 17, [0, 1])\n      faderRef.current.style.opacity = String(opacity)\n    }\n  }\n\n  function onTransitionEnd({ propertyName, target }: React.TransitionEvent) {\n    // We can only measure height after the `scale` transition ends,\n    // otherwise we will measure height as a multiple of the animating value\n    // which will give us an incorrect value.\n    if (propertyName === 'scale' && target === dialogRef.current) {\n      setAnimating(false)\n    }\n  }\n\n  return (\n    <ErrorOverlayOverlay fixed={isBuildError} {...animationProps}>\n      <div\n        data-nextjs-dialog-root\n        onTransitionEnd={onTransitionEnd}\n        ref={dialogRef}\n        {...animationProps}\n      >\n        <ErrorOverlayNav\n          runtimeErrors={runtimeErrors}\n          activeIdx={activeIdx}\n          setActiveIndex={setActiveIndex}\n          versionInfo={versionInfo}\n          isTurbopack={isTurbopack}\n        />\n        <ErrorOverlayDialog\n          onClose={onClose}\n          dialogResizerRef={dialogResizerRef}\n          data-has-footer={hasFooter}\n          onScroll={onScroll}\n          footer={\n            hasFooter && (\n              <ErrorOverlayFooter\n                footerMessage={footerMessage}\n                errorCode={errorCode}\n              />\n            )\n          }\n        >\n          <Resizer\n            ref={dialogResizerRef}\n            measure={!animating}\n            data-nextjs-dialog-sizer\n          >\n            <DialogContent>\n              <ErrorOverlayDialogHeader>\n                <div\n                  className=\"nextjs__container_errors__error_title\"\n                  // allow assertion in tests before error rating is implemented\n                  data-nextjs-error-code={errorCode}\n                >\n                  <span data-nextjs-error-label-group>\n                    <ErrorTypeLabel errorType={errorType} />\n                    {error.environmentName && (\n                      <EnvironmentNameLabel\n                        environmentName={error.environmentName}\n                      />\n                    )}\n                  </span>\n                  <ErrorOverlayToolbar error={error} debugInfo={debugInfo} />\n                </div>\n                <ErrorMessage errorMessage={errorMessage} />\n              </ErrorOverlayDialogHeader>\n\n              <ErrorOverlayDialogBody>{children}</ErrorOverlayDialogBody>\n            </DialogContent>\n          </Resizer>\n\n          <ErrorOverlayBottomStack\n            errorCount={errorCount}\n            activeIdx={activeIdx ?? 0}\n          />\n        </ErrorOverlayDialog>\n        <Fader ref={faderRef} side=\"top\" stop=\"50%\" blur=\"4px\" height={48} />\n      </div>\n    </ErrorOverlayOverlay>\n  )\n}\n\nfunction clamp(value: number, [min, max]: [number, number]) {\n  return Math.min(Math.max(value, min), max)\n}\n\nexport const styles = `\n  ${OVERLAY_STYLES}\n  ${DIALOG_STYLES}\n  ${DIALOG_HEADER_STYLES}\n  ${DIALOG_BODY_STYLES}\n\n  ${floatingHeaderStyles}\n  ${errorTypeLabelStyles}\n  ${errorMessageStyles}\n  ${toolbarStyles}\n  ${CALL_STACK_STYLES}\n\n  [data-nextjs-error-label-group] {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n  }\n`\n"],"names":["ErrorOverlayLayout","styles","errorMessage","errorType","children","errorCode","errorCount","error","debugInfo","isBuildError","onClose","versionInfo","runtimeErrors","activeIdx","setActiveIndex","footerMessage","isTurbopack","dialogResizerRef","rendered","transitionDurationMs","animationProps","style","animating","setAnimating","React","useState","Boolean","faderRef","useRef","hasFooter","dialogRef","useFocusTrap","onScroll","e","current","opacity","clamp","currentTarget","scrollTop","String","onTransitionEnd","propertyName","target","ErrorOverlayOverlay","fixed","div","data-nextjs-dialog-root","ref","ErrorOverlayNav","ErrorOverlayDialog","data-has-footer","footer","ErrorOverlayFooter","Resizer","measure","data-nextjs-dialog-sizer","DialogContent","ErrorOverlayDialogHeader","className","data-nextjs-error-code","span","data-nextjs-error-label-group","ErrorTypeLabel","environmentName","EnvironmentNameLabel","ErrorOverlayToolbar","ErrorMessage","ErrorOverlayDialogBody","ErrorOverlayBottomStack","Fader","side","stop","blur","height","value","min","max","Math","OVERLAY_STYLES","DIALOG_STYLES","DIALOG_HEADER_STYLES","DIALOG_BODY_STYLES","floatingHeaderStyles","errorTypeLabelStyles","errorMessageStyles","toolbarStyles","CALL_STACK_STYLES"],"mappings":"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","ignoreList":[0]}