{"version":3,"sources":["../../../src/client/react-client-callbacks/error-boundary-callbacks.ts"],"sourcesContent":["// This file is only used in app router due to the specific error state handling.\n\nimport type { ErrorInfo } from 'react'\nimport {\n  setOwnerStackIfAvailable,\n  setComponentStack,\n  coerceError,\n} from '../components/errors/stitched-error'\nimport { handleClientError } from '../components/errors/use-error-handler'\nimport { isNextRouterError } from '../components/is-next-router-error'\nimport { isBailoutToCSRError } from '../../shared/lib/lazy-dynamic/bailout-to-csr'\nimport { reportGlobalError } from './report-global-error'\nimport { originConsoleError } from '../components/globals/intercept-console-error'\nimport { ErrorBoundaryHandler } from '../components/error-boundary'\nimport DefaultErrorBoundary from '../components/global-error'\n\nexport function onCaughtError(\n  thrownValue: unknown,\n  errorInfo: ErrorInfo & { errorBoundary?: React.Component }\n) {\n  const errorBoundaryComponent = errorInfo.errorBoundary?.constructor\n\n  let isImplicitErrorBoundary\n\n  if (process.env.NODE_ENV !== 'production') {\n    const { AppDevOverlayErrorBoundary } =\n      require('../components/react-dev-overlay/app/app-dev-overlay-error-boundary') as typeof import('../components/react-dev-overlay/app/app-dev-overlay-error-boundary')\n\n    isImplicitErrorBoundary =\n      errorBoundaryComponent === AppDevOverlayErrorBoundary\n  }\n\n  isImplicitErrorBoundary =\n    isImplicitErrorBoundary ||\n    (errorBoundaryComponent === ErrorBoundaryHandler &&\n      (errorInfo.errorBoundary! as InstanceType<typeof ErrorBoundaryHandler>)\n        .props.errorComponent === DefaultErrorBoundary)\n\n  if (isImplicitErrorBoundary) {\n    // We don't consider errors caught unless they're caught by an explicit error\n    // boundary. The built-in ones are considered implicit.\n    // This mimics how the same app would behave without Next.js.\n    return onUncaughtError(thrownValue, errorInfo)\n  }\n\n  // Skip certain custom errors which are not expected to be reported on client\n  if (isBailoutToCSRError(thrownValue) || isNextRouterError(thrownValue)) return\n\n  if (process.env.NODE_ENV !== 'production') {\n    const errorBoundaryName =\n      // read react component displayName\n      (errorBoundaryComponent as any)?.displayName ||\n      errorBoundaryComponent?.name ||\n      'Unknown'\n\n    const componentThatErroredFrame = errorInfo?.componentStack?.split('\\n')[1]\n\n    // Match chrome or safari stack trace\n    const matches =\n      // regex to match the function name in the stack trace\n      // example 1: at Page (http://localhost:3000/_next/static/chunks/pages/index.js?ts=1631600000000:2:1)\n      // example 2: Page@http://localhost:3000/_next/static/chunks/pages/index.js?ts=1631600000000:2:1\n      componentThatErroredFrame?.match(/\\s+at (\\w+)\\s+|(\\w+)@/) ?? []\n    const componentThatErroredName = matches[1] || matches[2] || 'Unknown'\n\n    // Create error location with errored component and error boundary, to match the behavior of default React onCaughtError handler.\n    const errorBoundaryMessage = `It was handled by the <${errorBoundaryName}> error boundary.`\n    const componentErrorMessage = componentThatErroredName\n      ? `The above error occurred in the <${componentThatErroredName}> component.`\n      : `The above error occurred in one of your components.`\n\n    const errorLocation = `${componentErrorMessage} ${errorBoundaryMessage}`\n\n    const error = coerceError(thrownValue)\n    setOwnerStackIfAvailable(error)\n    // TODO: change to passing down errorInfo later\n    // In development mode, pass along the component stack to the error\n    if (errorInfo.componentStack) {\n      setComponentStack(error, errorInfo.componentStack)\n    }\n\n    // Log and report the error with location but without modifying the error stack\n    originConsoleError('%o\\n\\n%s', thrownValue, errorLocation)\n\n    handleClientError(error)\n  } else {\n    originConsoleError(thrownValue)\n  }\n}\n\nexport function onUncaughtError(\n  thrownValue: unknown,\n  errorInfo: React.ErrorInfo\n) {\n  // Skip certain custom errors which are not expected to be reported on client\n  if (isBailoutToCSRError(thrownValue) || isNextRouterError(thrownValue)) return\n\n  if (process.env.NODE_ENV !== 'production') {\n    const error = coerceError(thrownValue)\n    setOwnerStackIfAvailable(error)\n\n    // TODO: change to passing down errorInfo later\n    // In development mode, pass along the component stack to the error\n    if (errorInfo.componentStack) {\n      setComponentStack(error, errorInfo.componentStack)\n    }\n\n    // TODO: Add an adendum to the overlay telling people about custom error boundaries.\n    reportGlobalError(error)\n  } else {\n    reportGlobalError(thrownValue)\n  }\n}\n"],"names":["onCaughtError","onUncaughtError","thrownValue","errorInfo","errorBoundaryComponent","errorBoundary","constructor","isImplicitErrorBoundary","process","env","NODE_ENV","AppDevOverlayErrorBoundary","require","ErrorBoundaryHandler","props","errorComponent","DefaultErrorBoundary","isBailoutToCSRError","isNextRouterError","errorBoundaryName","displayName","name","componentThatErroredFrame","componentStack","split","matches","match","componentThatErroredName","errorBoundaryMessage","componentErrorMessage","errorLocation","error","coerceError","setOwnerStackIfAvailable","setComponentStack","originConsoleError","handleClientError","reportGlobalError"],"mappings":"AAAA,iFAAiF;;;;;;;;;;;;;;;;IAgBjEA,aAAa;eAAbA;;IA0EAC,eAAe;eAAfA;;;;+BAnFT;iCAC2B;mCACA;8BACE;mCACF;uCACC;+BACE;sEACJ;AAE1B,SAASD,cACdE,WAAoB,EACpBC,SAA0D;QAE3BA;IAA/B,MAAMC,0BAAyBD,2BAAAA,UAAUE,aAAa,qBAAvBF,yBAAyBG,WAAW;IAEnE,IAAIC;IAEJ,IAAIC,QAAQC,GAAG,CAACC,QAAQ,KAAK,cAAc;QACzC,MAAM,EAAEC,0BAA0B,EAAE,GAClCC,QAAQ;QAEVL,0BACEH,2BAA2BO;IAC/B;IAEAJ,0BACEA,2BACCH,2BAA2BS,mCAAoB,IAC9C,AAACV,UAAUE,aAAa,CACrBS,KAAK,CAACC,cAAc,KAAKC,oBAAoB;IAEpD,IAAIT,yBAAyB;QAC3B,6EAA6E;QAC7E,uDAAuD;QACvD,6DAA6D;QAC7D,OAAON,gBAAgBC,aAAaC;IACtC;IAEA,6EAA6E;IAC7E,IAAIc,IAAAA,iCAAmB,EAACf,gBAAgBgB,IAAAA,oCAAiB,EAAChB,cAAc;IAExE,IAAIM,QAAQC,GAAG,CAACC,QAAQ,KAAK,cAAc;YAOPP;QANlC,MAAMgB,oBAEJ,CADA,mCAAmC;QAClCf,0CAAD,AAACA,uBAAgCgB,WAAW,MAC5ChB,0CAAAA,uBAAwBiB,IAAI,KAC5B;QAEF,MAAMC,4BAA4BnB,8BAAAA,4BAAAA,UAAWoB,cAAc,qBAAzBpB,0BAA2BqB,KAAK,CAAC,KAAK,CAAC,EAAE;YAIzE,sDAAsD;QACtD,qGAAqG;QACrG,gGAAgG;QAChGF;QALF,qCAAqC;QACrC,MAAMG,UAIJH,CAAAA,mCAAAA,6CAAAA,0BAA2BI,KAAK,CAAC,oCAAjCJ,mCAA6D,EAAE;QACjE,MAAMK,2BAA2BF,OAAO,CAAC,EAAE,IAAIA,OAAO,CAAC,EAAE,IAAI;QAE7D,iIAAiI;QACjI,MAAMG,uBAAuB,AAAC,4BAAyBT,oBAAkB;QACzE,MAAMU,wBAAwBF,2BAC1B,AAAC,sCAAmCA,2BAAyB,iBAC5D;QAEL,MAAMG,gBAAgB,AAAGD,wBAAsB,MAAGD;QAElD,MAAMG,QAAQC,IAAAA,0BAAW,EAAC9B;QAC1B+B,IAAAA,uCAAwB,EAACF;QACzB,+CAA+C;QAC/C,mEAAmE;QACnE,IAAI5B,UAAUoB,cAAc,EAAE;YAC5BW,IAAAA,gCAAiB,EAACH,OAAO5B,UAAUoB,cAAc;QACnD;QAEA,+EAA+E;QAC/EY,IAAAA,yCAAkB,EAAC,YAAYjC,aAAa4B;QAE5CM,IAAAA,kCAAiB,EAACL;IACpB,OAAO;QACLI,IAAAA,yCAAkB,EAACjC;IACrB;AACF;AAEO,SAASD,gBACdC,WAAoB,EACpBC,SAA0B;IAE1B,6EAA6E;IAC7E,IAAIc,IAAAA,iCAAmB,EAACf,gBAAgBgB,IAAAA,oCAAiB,EAAChB,cAAc;IAExE,IAAIM,QAAQC,GAAG,CAACC,QAAQ,KAAK,cAAc;QACzC,MAAMqB,QAAQC,IAAAA,0BAAW,EAAC9B;QAC1B+B,IAAAA,uCAAwB,EAACF;QAEzB,+CAA+C;QAC/C,mEAAmE;QACnE,IAAI5B,UAAUoB,cAAc,EAAE;YAC5BW,IAAAA,gCAAiB,EAACH,OAAO5B,UAAUoB,cAAc;QACnD;QAEA,oFAAoF;QACpFc,IAAAA,oCAAiB,EAACN;IACpB,OAAO;QACLM,IAAAA,oCAAiB,EAACnC;IACpB;AACF","ignoreList":[0]}