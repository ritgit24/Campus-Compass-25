{"version":3,"sources":["../../../../src/shared/lib/devtool/app-segment-tree.tsx"],"sourcesContent":["'use client'\n\nimport { type ReactNode, useEffect, useSyncExternalStore } from 'react'\nimport { createTrie, type Trie } from './trie'\n\nexport type SegmentNode = {\n  type: string\n  pagePath: string\n}\n\ntype DevtoolClientState = {\n  tree?: Trie<SegmentNode>\n}\n\nconst DEFAULT_CLIENT_STATE =\n  typeof window === 'undefined'\n    ? undefined\n    : createTrie<SegmentNode>({\n        getKey: (item) => item.pagePath,\n      })\n\ndeclare global {\n  interface Window {\n    __NEXT_DEVTOOLS_CLIENT_STATE?: DevtoolClientState\n  }\n}\n\nfunction getSegmentTreeClientState(): DevtoolClientState {\n  if (typeof window === 'undefined') {\n    return {}\n  }\n  if (!window.__NEXT_DEVTOOLS_CLIENT_STATE) {\n    window.__NEXT_DEVTOOLS_CLIENT_STATE = {\n      // Initial state\n      tree: DEFAULT_CLIENT_STATE,\n    }\n  }\n  return window.__NEXT_DEVTOOLS_CLIENT_STATE\n}\n\nconst listeners = typeof window === 'undefined' ? null : new Set<() => void>()\n\nconst createSegmentTreeStore = (): {\n  subscribe: (callback: () => void) => () => void\n  getSnapshot: () => DevtoolClientState\n  getServerSnapshot: () => undefined\n} => {\n  if (typeof window === 'undefined') {\n    return {\n      subscribe: () => () => void 0,\n      getSnapshot: () => ({}),\n      getServerSnapshot: () => undefined,\n    }\n  }\n\n  // return a store that can be used by useSyncExternalStore\n  return {\n    subscribe: (callback) => {\n      listeners?.add(callback)\n      return () => listeners?.delete(callback)\n    },\n    getSnapshot: () => {\n      return getSegmentTreeClientState()\n    },\n    getServerSnapshot: () => {\n      return undefined\n    },\n  }\n}\n\nconst { subscribe, getSnapshot, getServerSnapshot } = createSegmentTreeStore()\n\nexport function SegmentViewNode({\n  type,\n  pagePath,\n  children,\n}: {\n  type: string\n  pagePath: string\n  children: ReactNode\n}) {\n  const clientState = getSegmentTreeClientState()\n  const tree = clientState.tree\n\n  useEffect(() => {\n    if (!tree) {\n      return\n    }\n    tree.insert({\n      type,\n      pagePath,\n    })\n  }, [type, pagePath, tree])\n\n  return children\n}\n\nexport function useSegmentTreeClientState() {\n  const state = useSyncExternalStore(subscribe, getSnapshot, getServerSnapshot)\n  return state\n}\n"],"names":["useEffect","useSyncExternalStore","createTrie","DEFAULT_CLIENT_STATE","window","undefined","getKey","item","pagePath","getSegmentTreeClientState","__NEXT_DEVTOOLS_CLIENT_STATE","tree","listeners","Set","createSegmentTreeStore","subscribe","getSnapshot","getServerSnapshot","callback","add","delete","SegmentViewNode","type","children","clientState","insert","useSegmentTreeClientState","state"],"mappings":"AAAA;AAEA,SAAyBA,SAAS,EAAEC,oBAAoB,QAAQ,QAAO;AACvE,SAASC,UAAU,QAAmB,SAAQ;AAW9C,MAAMC,uBACJ,OAAOC,WAAW,cACdC,YACAH,WAAwB;IACtBI,QAAQ,CAACC,OAASA,KAAKC,QAAQ;AACjC;AAQN,SAASC;IACP,IAAI,OAAOL,WAAW,aAAa;QACjC,OAAO,CAAC;IACV;IACA,IAAI,CAACA,OAAOM,4BAA4B,EAAE;QACxCN,OAAOM,4BAA4B,GAAG;YACpC,gBAAgB;YAChBC,MAAMR;QACR;IACF;IACA,OAAOC,OAAOM,4BAA4B;AAC5C;AAEA,MAAME,YAAY,OAAOR,WAAW,cAAc,OAAO,IAAIS;AAE7D,MAAMC,yBAAyB;IAK7B,IAAI,OAAOV,WAAW,aAAa;QACjC,OAAO;YACLW,WAAW,IAAM,IAAM,KAAK;YAC5BC,aAAa,IAAO,CAAA,CAAC,CAAA;YACrBC,mBAAmB,IAAMZ;QAC3B;IACF;IAEA,0DAA0D;IAC1D,OAAO;QACLU,WAAW,CAACG;YACVN,6BAAAA,UAAWO,GAAG,CAACD;YACf,OAAO,IAAMN,6BAAAA,UAAWQ,MAAM,CAACF;QACjC;QACAF,aAAa;YACX,OAAOP;QACT;QACAQ,mBAAmB;YACjB,OAAOZ;QACT;IACF;AACF;AAEA,MAAM,EAAEU,SAAS,EAAEC,WAAW,EAAEC,iBAAiB,EAAE,GAAGH;AAEtD,OAAO,SAASO,gBAAgB,KAQ/B;IAR+B,IAAA,EAC9BC,IAAI,EACJd,QAAQ,EACRe,QAAQ,EAKT,GAR+B;IAS9B,MAAMC,cAAcf;IACpB,MAAME,OAAOa,YAAYb,IAAI;IAE7BX,UAAU;QACR,IAAI,CAACW,MAAM;YACT;QACF;QACAA,KAAKc,MAAM,CAAC;YACVH;YACAd;QACF;IACF,GAAG;QAACc;QAAMd;QAAUG;KAAK;IAEzB,OAAOY;AACT;AAEA,OAAO,SAASG;IACd,MAAMC,QAAQ1B,qBAAqBc,WAAWC,aAAaC;IAC3D,OAAOU;AACT","ignoreList":[0]}