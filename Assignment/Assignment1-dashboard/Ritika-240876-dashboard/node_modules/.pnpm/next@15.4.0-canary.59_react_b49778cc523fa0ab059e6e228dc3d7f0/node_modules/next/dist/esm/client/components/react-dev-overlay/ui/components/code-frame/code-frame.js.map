{"version":3,"sources":["../../../../../../../src/client/components/react-dev-overlay/ui/components/code-frame/code-frame.tsx"],"sourcesContent":["import type { StackFrame } from 'next/dist/compiled/stacktrace-parser'\nimport { useMemo } from 'react'\nimport { HotlinkedText } from '../hot-linked-text'\nimport { getFrameSource } from '../../../utils/stack-frame'\nimport { useOpenInEditor } from '../../utils/use-open-in-editor'\nimport { ExternalIcon } from '../../icons/external'\nimport { FileIcon } from '../../icons/file'\nimport {\n  formatCodeFrame,\n  groupCodeFrameLines,\n  parseLineNumberFromCodeFrameLine,\n} from './parse-code-frame'\n\nexport type CodeFrameProps = { stackFrame: StackFrame; codeFrame: string }\n\nexport function CodeFrame({ stackFrame, codeFrame }: CodeFrameProps) {\n  const parsedLineStates = useMemo(() => {\n    const decodedLines = groupCodeFrameLines(formatCodeFrame(codeFrame))\n\n    return decodedLines.map((line) => {\n      return {\n        line,\n        parsedLine: parseLineNumberFromCodeFrameLine(line, stackFrame),\n      }\n    })\n  }, [codeFrame, stackFrame])\n\n  const open = useOpenInEditor({\n    file: stackFrame.file,\n    lineNumber: stackFrame.lineNumber,\n    column: stackFrame.column,\n  })\n\n  const fileExtension = stackFrame?.file?.split('.').pop()\n\n  // TODO: make the caret absolute\n  return (\n    <div data-nextjs-codeframe>\n      <div className=\"code-frame-header\">\n        {/* TODO: This is <div> in `Terminal` component.\n        Changing now will require multiple test snapshots updates.\n        Leaving as <div> as is trivial and does not affect the UI.\n        Change when the new redbox matcher `toDisplayRedbox` is used.\n        */}\n        <p className=\"code-frame-link\">\n          <span className=\"code-frame-icon\">\n            <FileIcon lang={fileExtension} />\n          </span>\n          <span data-text>\n            {getFrameSource(stackFrame)} @{' '}\n            <HotlinkedText text={stackFrame.methodName} />\n          </span>\n          <button\n            aria-label=\"Open in editor\"\n            data-with-open-in-editor-link-source-file\n            onClick={open}\n          >\n            <span className=\"code-frame-icon\" data-icon=\"right\">\n              <ExternalIcon width={16} height={16} />\n            </span>\n          </button>\n        </p>\n      </div>\n      <pre className=\"code-frame-pre\">\n        <div className=\"code-frame-lines\">\n          {parsedLineStates.map(({ line, parsedLine }, lineIndex) => {\n            const { lineNumber, isErroredLine } = parsedLine\n\n            const lineNumberProps: Record<string, string | boolean> = {}\n            if (lineNumber) {\n              lineNumberProps['data-nextjs-codeframe-line'] = lineNumber\n            }\n            if (isErroredLine) {\n              lineNumberProps['data-nextjs-codeframe-line--errored'] = true\n            }\n\n            return (\n              <div key={`line-${lineIndex}`} {...lineNumberProps}>\n                {line.map((entry, entryIndex) => (\n                  <span\n                    key={`frame-${entryIndex}`}\n                    style={{\n                      color: entry.fg ? `var(--color-${entry.fg})` : undefined,\n                      ...(entry.decoration === 'bold'\n                        ? // TODO(jiwon): This used to be 800, but the symbols like `─┬─` are\n                          // having longer width than expected on Geist Mono font-weight\n                          // above 600, hence a temporary fix is to use 500 for bold.\n                          { fontWeight: 500 }\n                        : entry.decoration === 'italic'\n                          ? { fontStyle: 'italic' }\n                          : undefined),\n                    }}\n                  >\n                    {entry.content}\n                  </span>\n                ))}\n              </div>\n            )\n          })}\n        </div>\n      </pre>\n    </div>\n  )\n}\n\nexport const CODE_FRAME_STYLES = `\n  [data-nextjs-codeframe] {\n    --code-frame-padding: 12px;\n    --code-frame-line-height: var(--size-16);\n    background-color: var(--color-background-200);\n    overflow: hidden;\n    color: var(--color-gray-1000);\n    text-overflow: ellipsis;\n    border: 1px solid var(--color-gray-400);\n    border-radius: 8px;\n    font-family: var(--font-stack-monospace);\n    font-size: var(--size-12);\n    line-height: var(--code-frame-line-height);\n    margin: 8px 0;\n\n    svg {\n      width: var(--size-16);\n      height: var(--size-16);\n    }\n  }\n\n  .code-frame-link,\n  .code-frame-pre {\n    padding: var(--code-frame-padding);\n  }\n\n  .code-frame-link svg {\n    flex-shrink: 0;\n  }\n\n  .code-frame-lines {\n    min-width: max-content;\n  }\n\n  .code-frame-link [data-text] {\n    display: inline-flex;\n    text-align: left;\n    margin: auto 6px;\n  }\n\n  .code-frame-header {\n    width: 100%;\n    transition: background 100ms ease-out;\n    border-radius: 8px 8px 0 0;\n    border-bottom: 1px solid var(--color-gray-400);\n  }\n\n  [data-with-open-in-editor-link-source-file] {\n    padding: 4px;\n    margin: -4px 0 -4px auto;\n    border-radius: var(--rounded-full);\n    margin-left: auto;\n\n    &:focus-visible {\n      outline: var(--focus-ring);\n      outline-offset: -2px;\n    }\n\n    &:hover {\n      background: var(--color-gray-100);\n    }\n  }\n\n  [data-nextjs-codeframe]::selection,\n  [data-nextjs-codeframe] *::selection {\n    background-color: var(--color-ansi-selection);\n  }\n\n  [data-nextjs-codeframe] *:not(a) {\n    color: inherit;\n    background-color: transparent;\n    font-family: var(--font-stack-monospace);\n  }\n\n  [data-nextjs-codeframe-line][data-nextjs-codeframe-line--errored=\"true\"] {\n    position: relative;\n    isolation: isolate;\n\n    > span { \n      position: relative;\n      z-index: 1;\n    }\n\n    &::after {\n      content: \"\";\n      width: calc(100% + var(--code-frame-padding) * 2);\n      height: var(--code-frame-line-height);\n      left: calc(-1 * var(--code-frame-padding));\n      background: var(--color-red-200);\n      box-shadow: 2px 0 0 0 var(--color-red-900) inset;\n      position: absolute;\n    }\n  }\n\n\n  [data-nextjs-codeframe] > * {\n    margin: 0;\n  }\n\n  .code-frame-link {\n    display: flex;\n    margin: 0;\n    outline: 0;\n  }\n  .code-frame-link [data-icon='right'] {\n    margin-left: auto;\n  }\n\n  [data-nextjs-codeframe] div > pre {\n    overflow: hidden;\n    display: inline-block;\n  }\n\n  [data-nextjs-codeframe] svg {\n    color: var(--color-gray-900);\n  }\n`\n"],"names":["useMemo","HotlinkedText","getFrameSource","useOpenInEditor","ExternalIcon","FileIcon","formatCodeFrame","groupCodeFrameLines","parseLineNumberFromCodeFrameLine","CodeFrame","stackFrame","codeFrame","parsedLineStates","decodedLines","map","line","parsedLine","open","file","lineNumber","column","fileExtension","split","pop","div","data-nextjs-codeframe","className","p","span","lang","data-text","text","methodName","button","aria-label","data-with-open-in-editor-link-source-file","onClick","data-icon","width","height","pre","lineIndex","isErroredLine","lineNumberProps","entry","entryIndex","style","color","fg","undefined","decoration","fontWeight","fontStyle","content","CODE_FRAME_STYLES"],"mappings":";AACA,SAASA,OAAO,QAAQ,QAAO;AAC/B,SAASC,aAAa,QAAQ,qBAAoB;AAClD,SAASC,cAAc,QAAQ,6BAA4B;AAC3D,SAASC,eAAe,QAAQ,iCAAgC;AAChE,SAASC,YAAY,QAAQ,uBAAsB;AACnD,SAASC,QAAQ,QAAQ,mBAAkB;AAC3C,SACEC,eAAe,EACfC,mBAAmB,EACnBC,gCAAgC,QAC3B,qBAAoB;AAI3B,OAAO,SAASC,UAAU,KAAyC;IAAzC,IAAA,EAAEC,UAAU,EAAEC,SAAS,EAAkB,GAAzC;QAkBFD;IAjBtB,MAAME,mBAAmBZ,QAAQ;QAC/B,MAAMa,eAAeN,oBAAoBD,gBAAgBK;QAEzD,OAAOE,aAAaC,GAAG,CAAC,CAACC;YACvB,OAAO;gBACLA;gBACAC,YAAYR,iCAAiCO,MAAML;YACrD;QACF;IACF,GAAG;QAACC;QAAWD;KAAW;IAE1B,MAAMO,OAAOd,gBAAgB;QAC3Be,MAAMR,WAAWQ,IAAI;QACrBC,YAAYT,WAAWS,UAAU;QACjCC,QAAQV,WAAWU,MAAM;IAC3B;IAEA,MAAMC,gBAAgBX,+BAAAA,mBAAAA,WAAYQ,IAAI,qBAAhBR,iBAAkBY,KAAK,CAAC,KAAKC,GAAG;IAEtD,gCAAgC;IAChC,qBACE,MAACC;QAAIC,uBAAqB;;0BACxB,KAACD;gBAAIE,WAAU;0BAMb,cAAA,MAACC;oBAAED,WAAU;;sCACX,KAACE;4BAAKF,WAAU;sCACd,cAAA,KAACrB;gCAASwB,MAAMR;;;sCAElB,MAACO;4BAAKE,WAAS;;gCACZ5B,eAAeQ;gCAAY;gCAAG;8CAC/B,KAACT;oCAAc8B,MAAMrB,WAAWsB,UAAU;;;;sCAE5C,KAACC;4BACCC,cAAW;4BACXC,2CAAyC;4BACzCC,SAASnB;sCAET,cAAA,KAACW;gCAAKF,WAAU;gCAAkBW,aAAU;0CAC1C,cAAA,KAACjC;oCAAakC,OAAO;oCAAIC,QAAQ;;;;;;;0BAKzC,KAACC;gBAAId,WAAU;0BACb,cAAA,KAACF;oBAAIE,WAAU;8BACZd,iBAAiBE,GAAG,CAAC,QAAuB2B;4BAAtB,EAAE1B,IAAI,EAAEC,UAAU,EAAE;wBACzC,MAAM,EAAEG,UAAU,EAAEuB,aAAa,EAAE,GAAG1B;wBAEtC,MAAM2B,kBAAoD,CAAC;wBAC3D,IAAIxB,YAAY;4BACdwB,eAAe,CAAC,6BAA6B,GAAGxB;wBAClD;wBACA,IAAIuB,eAAe;4BACjBC,eAAe,CAAC,sCAAsC,GAAG;wBAC3D;wBAEA,qBACE,KAACnB;4BAA+B,GAAGmB,eAAe;sCAC/C5B,KAAKD,GAAG,CAAC,CAAC8B,OAAOC,2BAChB,KAACjB;oCAECkB,OAAO;wCACLC,OAAOH,MAAMI,EAAE,GAAG,AAAC,iBAAcJ,MAAMI,EAAE,GAAC,MAAKC;wCAC/C,GAAIL,MAAMM,UAAU,KAAK,SAErB,8DAA8D;wCAC9D,2DAA2D;wCAC3D;4CAAEC,YAAY;wCAAI,IAClBP,MAAMM,UAAU,KAAK,WACnB;4CAAEE,WAAW;wCAAS,IACtBH,SAAS;oCACjB;8CAECL,MAAMS,OAAO;mCAbT,AAAC,WAAQR;2BAHV,AAAC,UAAOJ;oBAqBtB;;;;;AAKV;AAEA,OAAO,MAAMa,oBAAqB,iiFAoHjC","ignoreList":[0]}