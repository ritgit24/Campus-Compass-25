{"version":3,"sources":["../../../../../src/client/components/react-dev-overlay/pages/client.ts"],"sourcesContent":["import * as Bus from './bus'\nimport { parseStack } from '../utils/parse-stack'\nimport { parseComponentStack } from '../utils/parse-component-stack'\nimport {\n  attachHydrationErrorState,\n  storeHydrationErrorStateFromConsoleArgs,\n} from './hydration-error-state'\nimport {\n  ACTION_BEFORE_REFRESH,\n  ACTION_BUILD_ERROR,\n  ACTION_BUILD_OK,\n  ACTION_DEV_INDICATOR,\n  ACTION_REFRESH,\n  ACTION_STATIC_INDICATOR,\n  ACTION_UNHANDLED_ERROR,\n  ACTION_UNHANDLED_REJECTION,\n  ACTION_VERSION_INFO,\n} from '../shared'\nimport type { VersionInfo } from '../../../../server/dev/parse-version-info'\nimport { getComponentStack, getOwnerStack } from '../../errors/stitched-error'\nimport type { DevIndicatorServerState } from '../../../../server/dev/dev-indicator-server-state'\n\nlet isRegistered = false\n\nfunction handleError(error: unknown) {\n  if (!error || !(error instanceof Error) || typeof error.stack !== 'string') {\n    // A non-error was thrown, we don't have anything to show. :-(\n    return\n  }\n\n  attachHydrationErrorState(error)\n\n  const componentStackTrace = getComponentStack(error)\n  const ownerStack = getOwnerStack(error)\n  const componentStackFrames =\n    typeof componentStackTrace === 'string'\n      ? parseComponentStack(componentStackTrace)\n      : undefined\n\n  // Skip ModuleBuildError and ModuleNotFoundError, as it will be sent through onBuildError callback.\n  // This is to avoid same error as different type showing up on client to cause flashing.\n  if (\n    error.name !== 'ModuleBuildError' &&\n    error.name !== 'ModuleNotFoundError'\n  ) {\n    Bus.emit({\n      type: ACTION_UNHANDLED_ERROR,\n      reason: error,\n      frames: parseStack((error.stack || '') + (ownerStack || '')),\n      componentStackFrames,\n    })\n  }\n}\n\nlet origConsoleError = console.error\nfunction nextJsHandleConsoleError(...args: any[]) {\n  // See https://github.com/facebook/react/blob/d50323eb845c5fde0d720cae888bf35dedd05506/packages/react-reconciler/src/ReactFiberErrorLogger.js#L78\n  const maybeError = process.env.NODE_ENV !== 'production' ? args[1] : args[0]\n  storeHydrationErrorStateFromConsoleArgs(...args)\n  // TODO: Surfaces non-errors logged via `console.error`.\n  handleError(maybeError)\n  origConsoleError.apply(window.console, args)\n}\n\nfunction onUnhandledError(event: ErrorEvent) {\n  const error = event?.error\n  handleError(error)\n}\n\nfunction onUnhandledRejection(ev: PromiseRejectionEvent) {\n  const reason = ev?.reason\n  if (\n    !reason ||\n    !(reason instanceof Error) ||\n    typeof reason.stack !== 'string'\n  ) {\n    // A non-error was thrown, we don't have anything to show. :-(\n    return\n  }\n\n  const error = reason\n  const ownerStack = getOwnerStack(error)\n  Bus.emit({\n    type: ACTION_UNHANDLED_REJECTION,\n    reason: reason,\n    frames: parseStack((error.stack || '') + (ownerStack || '')),\n  })\n}\n\nexport function register() {\n  if (isRegistered) {\n    return\n  }\n  isRegistered = true\n\n  try {\n    Error.stackTraceLimit = 50\n  } catch {}\n\n  window.addEventListener('error', onUnhandledError)\n  window.addEventListener('unhandledrejection', onUnhandledRejection)\n  window.console.error = nextJsHandleConsoleError\n}\n\nexport function onBuildOk() {\n  Bus.emit({ type: ACTION_BUILD_OK })\n}\n\nexport function onBuildError(message: string) {\n  Bus.emit({ type: ACTION_BUILD_ERROR, message })\n}\n\nexport function onRefresh() {\n  Bus.emit({ type: ACTION_REFRESH })\n}\n\nexport function onBeforeRefresh() {\n  Bus.emit({ type: ACTION_BEFORE_REFRESH })\n}\n\nexport function onVersionInfo(versionInfo: VersionInfo) {\n  Bus.emit({ type: ACTION_VERSION_INFO, versionInfo })\n}\n\nexport function onStaticIndicator(isStatic: boolean) {\n  Bus.emit({ type: ACTION_STATIC_INDICATOR, staticIndicator: isStatic })\n}\n\nexport function onDevIndicator(devIndicatorsState: DevIndicatorServerState) {\n  Bus.emit({ type: ACTION_DEV_INDICATOR, devIndicator: devIndicatorsState })\n}\n\nexport { getErrorByType } from '../utils/get-error-by-type'\nexport { getServerError } from '../utils/node-stack-frames'\n"],"names":["Bus","parseStack","parseComponentStack","attachHydrationErrorState","storeHydrationErrorStateFromConsoleArgs","ACTION_BEFORE_REFRESH","ACTION_BUILD_ERROR","ACTION_BUILD_OK","ACTION_DEV_INDICATOR","ACTION_REFRESH","ACTION_STATIC_INDICATOR","ACTION_UNHANDLED_ERROR","ACTION_UNHANDLED_REJECTION","ACTION_VERSION_INFO","getComponentStack","getOwnerStack","isRegistered","handleError","error","Error","stack","componentStackTrace","ownerStack","componentStackFrames","undefined","name","emit","type","reason","frames","origConsoleError","console","nextJsHandleConsoleError","args","maybeError","process","env","NODE_ENV","apply","window","onUnhandledError","event","onUnhandledRejection","ev","register","stackTraceLimit","addEventListener","onBuildOk","onBuildError","message","onRefresh","onBeforeRefresh","onVersionInfo","versionInfo","onStaticIndicator","isStatic","staticIndicator","onDevIndicator","devIndicatorsState","devIndicator","getErrorByType","getServerError"],"mappings":"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","ignoreList":[0]}